NODE=$1
rm ${NODE}.keystore
rm client.truststore

echo "Gen key"
keytool -genkeypair -keyalg RSA -alias ${NODE} -keystore ${NODE}.keystore -storepass cassandra -keypass cassandra -validity 365 -keysize 2048 -dname "CN=${NODE}, OU=cluster_name, O=org_name, C=US"


echo "Gen csr"
keytool -keystore ${NODE}.keystore -alias ${NODE} -certreq -file ${NODE}.csr -keypass cassandra -storepass cassandra -dname "CN=${NODE}, OU=cluster_name, O=org_name, C=US"

echo "Sign csr"
openssl x509 -req -CA rootCa.crt -CAkey rootCa.key -in ${NODE}.csr -out ${NODE}.crt_signed -days 365 -CAcreateserial -passin pass:cassandra

echo "import root"
keytool -keystore ${NODE}.keystore -alias rootCa -importcert -file rootCa.crt -noprompt  -keypass cassandra -storepass cassandra

echo "import signed"
keytool -keystore ${NODE}.keystore -alias ${NODE} -importcert -noprompt -file ${NODE}.crt_signed -keypass cassandra -storepass cassandra

rm ${NODE}.csr
rm ${NODE}.crt_signed
